<div class="card">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold m-0">
      <i class="pi pi-history mr-2"></i>
      下載歷史
    </h2>
    @if (history().length > 0) {
      <p-button
        label="清除全部"
        icon="pi pi-trash"
        severity="danger"
        [outlined]="true"
        (onClick)="clearHistory()"
      ></p-button>
    }
  </div>

  @if (history().length > 0) {
    <p-table [value]="history()" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]">
      <ng-template #header>
        <tr>
          <th>標題</th>
          <th style="width: 100px">類型</th>
          <th style="width: 100px">畫質</th>
          <th style="width: 120px">狀態</th>
          <th style="width: 180px">下載時間</th>
        </tr>
      </ng-template>
      <ng-template #body let-record>
        <tr>
          <td>
            <span class="font-semibold">{{ record.title }}</span>
          </td>
          <td>
            <p-tag
              [value]="record.type === 'audio' ? '音樂' : '影片'"
              [severity]="getTypeSeverity(record.type)"
            ></p-tag>
          </td>
          <td>{{ record.quality }}</td>
          <td>
            <p-tag
              [value]="record.status === 'success' ? '成功' : '失敗'"
              [severity]="getStatusSeverity(record.status)"
            ></p-tag>
          </td>
          <td>{{ formatDate(record.downloadedAt) }}</td>
        </tr>
      </ng-template>
    </p-table>
  } @else {
    <div class="flex flex-col items-center gap-2 p-8 text-gray-400">
      <i class="pi pi-inbox" style="font-size: 3rem"></i>
      <p>尚無下載紀錄</p>
    </div>
  }
</div>
