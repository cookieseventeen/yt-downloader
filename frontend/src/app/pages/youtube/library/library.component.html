<div class="card">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold m-0">
            <i class="pi pi-folder-open mr-2"></i>
            媒體庫
        </h2>
        <p-button label="重新整理" icon="pi pi-refresh" [outlined]="true" (onClick)="loadFiles()"></p-button>
    </div>

    <p-table [value]="files()" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]">
        <ng-template #header>
            <tr>
                <th>檔名</th>
                <th style="width: 100px">類型</th>
                <th style="width: 100px">大小</th>
                <th style="width: 180px">下載時間</th>
                <th style="width: 140px">操作</th>
            </tr>
        </ng-template>
        <ng-template #body let-file>
            <tr>
                <td class="font-semibold">{{ file.filename }}</td>
                <td>
                    <p-tag [value]="file.type === 'audio' ? '音樂' : '影片'" [severity]="getTypeSeverity(file.type)"></p-tag>
                </td>
                <td>{{ formatSize(file.size) }}</td>
                <td>{{ formatDate(file.updatedAt) }}</td>
                <td>
                    <div class="flex gap-2">
                        <p-button icon="pi pi-download" severity="info" [rounded]="true" [text]="true" pTooltip="下載" (onClick)="downloadFileAction(file)"></p-button>
                        <p-button icon="pi pi-play" severity="success" [rounded]="true" [text]="true" pTooltip="播放" (onClick)="playFile(file)"></p-button>
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [text]="true" pTooltip="刪除" (onClick)="confirmDelete(file)"></p-button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="5">
                    <div class="flex flex-col items-center gap-2 p-8 text-gray-400">
                        <i class="pi pi-folder" style="font-size: 3rem"></i>
                        <p>目前沒有已下載的檔案</p>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- 播放器 Dialog -->
<p-dialog [(visible)]="displayPlayer" [modal]="true" [style]="{ width: '800px', maxWidth: '95vw' }" [header]="currentFile?.filename || '播放媒體'" (onHide)="onPlayerHide()" [dismissableMask]="true">
    <div class="flex justify-center bg-black rounded-lg overflow-hidden" *ngIf="streamUrl">
        <video *ngIf="currentFile?.type === 'video'" [src]="streamUrl" controls autoplay class="w-full max-h-[60vh]"></video>

        <audio *ngIf="currentFile?.type === 'audio'" [src]="streamUrl" controls autoplay class="w-full my-8"></audio>
    </div>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
